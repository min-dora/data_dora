# 대전광역시 동별 EPDO(사고피해정도지수) 지도 작성_README
## ## encoding by. CP949

## # 기초환경설치
### package설치 (dplyr, writexl, readxl, ggmap)

```c 
install.packages("dplyr")

install.packages("writexl")

install.packages("readxl")

install.packages("ggmap")
```	

### library 불러오기
```c 
library(dplyr)

library(writexl)

library(readxl)

library(ggmap)
```
---------------------------------------------
---------------------------------------------
---------------------------------------------

## # 대전광역시 사망사고건수

### 원본 데이터 불러오기
+ 코드를 실행하여 첨부한 원본데이터(가해자차종 또는 피해자차종이 이륜차인 교통사고 정보(2015~2019년).csv) 불러오기
```c 
data <- read.csv(file.choose())
```

### 필요한 변수 선택
+ filter()를 통해 원본 데이터(data)에서 사용할 변수들만 뽑아오기
```c 
data1 <- filter(data,가해자신체상해정도=="사망"&발생지_시도=="대전")
```

### 동별 사망사고건수 데이터 생성
+ group_by()와 summarise()를 통해 동별로 사고건수를 뽑아 data2에 저장
```c 
data2 <- group_by(data1,법정동명) %>% summarise(n=n())
```

### 뽑힌 데이터 개수 확인
+ View()를 통해 data2의 행(동 이름) 개수를 확인
```c 
View(data2)
```

---------------------------------------------
---------------------------------------------
---------------------------------------------

## # 대전광역시 부상사고건수

### 원본 데이터 불러오기
+ 코드를 실행하여 첨부한 원본데이터(가해자차종 또는 피해자차종이 이륜차인 교통사고 정보(2015~2019년).csv) 불러오기
```c
data3 <- read.csv(file.choose()) 
```

### 필요한 변수 선택
+ filter함수를 통해 원본데이터(data3)에서 사용할 변수들만 뽑아오기
```c
data4 <- filter(data3,가해자신체상해정도=="중상"|가해자신체상해정도=="경상"|가해자신체상해정도=="부상신고")
data5 <- filter(data4,발생지_시도=="대전")
```

### 동별 부상사고건수 데이터 생성
+ group_by()와 summarise()를 통해 동별로 사고건수를 뽑아 data6에 저장
```c
data6 <- group_by(data5,법정동명) %>% summarise(n=n())
```

### 뽑힌 데이터 개수 확인
+ View()를 통해 data6의 행(동 이름) 개수를 확인
```c
View(data6)
```

### 컬럼명 변경
+ 뒤에 데이터 결합을 하기 위한 변수명 일치
```c
names(data6) <- c("법정동명","count")
```


---------------------------------------------
---------------------------------------------
---------------------------------------------

## # EPDO 구하기 & 위치정보

### 데이터 결합
+ rbind()를 통해 사망사고건수(data2)와 부상사고건수(data6) 합치기
```c
Dong <- rbind(data2,data6)
```

### 결합한 데이터를 엑셀파일로 저장
+ write_xlsx()를 통해 병합한 데이터(Dong)를 xlsx파일로 R working directory에 저장
```c
write_xlsx(Dong,path="동별score.xlsx")
```

---------------------------------------------

### ※ EPDO를 구하기 전에 ! ※

### EPDO란?
+ 사고피해정도(심각도)지수로 2010년부터 최근 몇년간 발생한 교통사고 인명피해 누적발생건수 평균 상위 지점을 말한다.
+ EPDO 계산
```c
EPDO = 12 X 사망사고건수 + 3 X 부상사고건수 + 물피사고
```

### 참고사항
+ 물피사고는 위의 원본 데이터에서 정확히 파악할 수 없는 부분이기 때문에 제외하고 EPDO를 구한다.
+ 위의 원본 데이터로 사고건수만을 생각한다면, 2015~2019년 대전지역에서 사망과 부상사고 모두 일어난 적이 있는 경우는 약 20여개의 동네뿐이다.
+ 또한, 절반 이상의 동네가 사망사고건이 없는 곳은 부상이 없고, 부상사고건이 있는 곳은 사망이 없는 경우이다.
+ 따라서, 사망사고건이 있는 곳은 부상사고건수를 0으로 , 부상사고건이 있는 곳은 사망사고건수를 0으로 설정하여 계산한다.

---------------------------------------------
# # in Excel

### EPDO 구하기
+ 엑셀에서 PRODUCT()를 통해 count의 1번째부터 24번째(사망사고 발생한 동네)값까지 =12 X 사망사고건수 계산
```c
=PRODUCT(셀 위치,12)
```
+ 엑셀에서 PRODUCT()를 통해 count의 25번째부터 마지막(부상사고 발생한 동네)값까지 =3 X 부상사고건수 계산
```c
=PRODUCT(셀 위치,3)
```

### 대전광역시 동별 위치정보
+ 동별로 지도에 점을 찍기 위해 구글링을 통해 구 이름과 위치정보(위도,경도)를 엑셀 데이터에 직접 입력

  
+ 파일명을 (동별사고score_위도경도.xlsx)로 변경해서 저장

---------------------------------------------
---------------------------------------------
---------------------------------------------
# # in R

## # 동별 EPDO 지도 작성

### 지도 전처리 데이터 불러오기
+ 코드를 실행하여 엑셀로 전처리한 데이터(동별사고score_위도경도.xlsx) 불러오기
```c
Dong <- read_excel(file.choose())
```

### 점 찍을 지도 위치 지정
+ 대전광역시가 중심이 되는 지도가 나타날 수 있는 경도,위도 설정(구글 맵 참고)
```c
boxLocation <- c(127.378953,36.321655)
```

### 구글 맵 인증key 등록 
+ 지도의 정확도를 더 높이기 위해 개인 계정 로그인으로 구글 맵에서 받은 인증key를 복사하여 등록
```c
register_google(key='AIzaSyALhVtJEUZzICnp4sMWulAJRPyFrraQMqg')
```

### 대전광역시의 구글 지도 작성
+ get_map()를 통해 설정한 boxLocation의 위치에 지도 타입과 출처를 작성하고, zoom으로 지도 확대
```c
KrMap <- get_map(boxLocation, maptype="roadmap",source="google",zoom=11)
```

### 동별 EPDO 지도 작성(동별 위치 점 찍기, 범례 위치 수정)
+ get_map()를 통해 설정한 지도(KrMap)를 ggmap()에 적용
+ geom_point()를 통해 x축과 y축을 설정하고 점 색상으로 시군구를, 점 크기로 EPDO를 구분
+ 지도의 구성 요소들의 디자인을 변경하는 theme()를 통해 범례 위치를 지도 안 쪽으로 수정
```c
ggmap(KrMap)+
  geom_point(data=Dong,aes(경도,위도,color=시군구,size=EPDO))+
  theme(legend.position = c(0.1,0.6)) 
```

## 2020-09-18 18:49 코드 수정 및 설명 추가 by.민종
